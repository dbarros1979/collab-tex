name: Build LaTeX PDF for PRs and Branches

on:
  push:
    branches:
      - '**'
  pull_request:

jobs:
  build_pdf:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install TeX Live Full
        run: |
          sudo apt-get update
          sudo apt-get install -y texlive-full

      - name: Compile LaTeX with pdflatex
        run: |
          mkdir -p docs
          pdflatex -interaction=nonstopmode -output-directory=docs main.tex
          bibtex docs/main || true
          pdflatex -interaction=nonstopmode -output-directory=docs main.tex
          pdflatex -interaction=nonstopmode -output-directory=docs main.tex

      - name: Deploy PDF to GitHub Pages (branch subfolder)
        run: |
          BRANCH="${GITHUB_HEAD_REF:-${GITHUB_REF_NAME}}"

          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          # clone gh-pages branch
          git fetch origin gh-pages || true
          git checkout gh-pages || git checkout --orphan gh-pages

          mkdir -p "$BRANCH"
          cp docs/main.pdf "$BRANCH/main.pdf"

          # garante que index.html est√° sempre no root
          cp docs/index.html index.html || true

          git add "$BRANCH/main.pdf" index.html || true
          git commit -m "Update PDF for branch $BRANCH [skip ci]" || echo "No changes"
          git push origin gh-pages
